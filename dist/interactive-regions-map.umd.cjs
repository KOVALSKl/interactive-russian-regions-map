(function(s,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("d3")):typeof define=="function"&&define.amd?define(["exports","vue","d3"],e):(s=typeof globalThis<"u"?globalThis:s||self,e(s.InteractiveRegionsMap={},s.Vue,s.d3))})(this,function(s,e,b){"use strict";function v(n){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const t in n)if(t!=="default"){const a=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(l,t,a.get?a:{enumerable:!0,get:()=>n[t]})}}return l.default=n,Object.freeze(l)}const p=v(b),M={class:"map-region"},B={class:"map-region-title"},j=["id","d"],D={__name:"MapRegion",props:["d","data"],emits:["regionClicked"],setup(n,{emit:l}){const t=n,a=l;return(m,r)=>(e.openBlock(),e.createElementBlock("g",M,[e.createElementVNode("title",B,`
      `+e.toDisplayString(n.data.properties.NAME_1)+`
    `,1),e.renderSlot(m.$slots,"map-region-component",{d:t.d,onClick:r[0]||(r[0]=d=>a("regionClicked",{event:d,data:n.data}))},()=>[e.createElementVNode("path",{id:`path_${n.data.properties.id}`,class:"map-region-path",d:t.d,onClick:r[1]||(r[1]=d=>a("regionClicked",{event:d,data:n.data}))},null,8,j)])]))}},I={class:"map-container w-100"},C=["width","height","viewBox"],N={id:"regions-container"},O=e.createElementVNode("path",{fill:"none",stroke:"white","stroke-linejoin":"round"},null,-1),S={__name:"RegionsMap",props:{mapData:{type:Object,required:!0},path:{type:Function,required:!0},width:{type:Number,default:900},height:{type:Number,default:900}},emits:["regionClicked"],setup(n,{emit:l}){const t=n,a=l;return(m,r)=>(e.openBlock(),e.createElementBlock("div",I,[(e.openBlock(),e.createElementBlock("svg",{id:"map",width:t.width,height:t.height,viewBox:[0,0,t.width,t.height]},[e.createElementVNode("g",N,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.mapData.features,d=>(e.openBlock(),e.createBlock(D,{key:d.properties.NAME_1,id:d.properties.id,data:d,d:n.path(d),onRegionClicked:r[0]||(r[0]=u=>a("regionClicked",u))},null,8,["id","data","d"]))),128)),O])],8,C))]))}},T=(n,l)=>{const t=n.__vccOpts||n;for(const[a,m]of l)t[a]=m;return t},$={class:"map-provider-container"},z=T({__name:"MapProvider",props:{width:{type:Number,default:900},height:{type:Number,default:900},mapData:{type:Object,required:!0},mapDataIndexes:{type:Object,default:null},mapProjection:{type:Object,default:null},animationDurationTime:{type:Number,default:1500},color:{type:String,default:"red"}},emits:["nextRegion","previousRegion","regionClicked","mapClicked"],setup(n,{emit:l}){const t=n,a=l,m=t.mapData.features.length,r=new Map,d=e.computed(()=>t.mapProjection??p.geoTransverseMercator().fitSize([t.width,t.height],t.mapData).rotate([-90,0]).center([-20,-20])),u=e.computed(()=>t.mapData.features[f.value]),f=e.ref(0),P=e.ref(p.geoPath().projection(d.value)),k=e.ref(p.zoom().scaleExtent([1,8]).on("zoom",L)),h=e.ref(null),y=e.ref(null);e.watch(u,(o,i)=>{var c,g;(c=r.get(i.properties.id))==null||c.style.setProperty("fill",null),(g=r.get(o.properties.id))==null||g.style.setProperty("fill",t.color)});function R(o){o>=0&&o<m&&(f.value=o)}function q(o){for(let i=0;i<m;i++)if(t.mapData[i].properties.id===o.properties.id)return i}function V(o){let i=o.properties.id;return t.mapDataIndexes[i].index}function A(){R(++f.value),w(),a("nextRegion")}function F(){R(--f.value),w(),a("previousRegion")}function w(){let o=u.value.properties.id;r.get(o).dispatchEvent(new PointerEvent("click",void 0))}function L(o){const{transform:i}=o;y.value.attr("transform",i),y.value.attr("stroke-width",1/i.k)}function G(){h.value.transition().duration(t.animationDurationTime).call(k.value.transform,p.zoomIdentity,p.zoomTransform(h.value.node()).invert([t.width/2,t.height/2]))}function H({event:o,data:i}){const[[c,g],[_,x]]=P.value.bounds(i);o.stopPropagation(),console.log(c,g,_,x);let E;t.mapDataIndexes?E=V(i):E=q(i),R(E),h.value.transition().duration(t.animationDurationTime).call(k.value.transform,p.zoomIdentity.translate(t.width/2,t.height/2).scale(Math.min(8,.9/Math.max((_-c)/t.width,(x-g)/t.height))).translate(-(c+_)/2,-(g+x)/2))}return e.onMounted(()=>{var i;h.value=p.select("svg").on("click",G).call(k.value),y.value=p.select("#regions-container");const o=document.querySelectorAll("path.map-region-path").values();for(let c of o)r.set(c.parentElement.id,c);(i=r.get(u.value.properties.id))==null||i.style.setProperty("fill",t.color),w()}),(o,i)=>(e.openBlock(),e.createElementBlock("div",$,[e.renderSlot(o.$slots,"map",{width:n.width,height:n.height,mapData:n.mapData,path:P.value,onRegionClicked:H},void 0,!0),e.renderSlot(o.$slots,"default",{currentRegion:u.value,onNextRegion:A,onPreviousRegion:F},void 0,!0)]))}},[["__scopeId","data-v-aaf3ea3d"]]);s.MapProvider=z,s.MapRegion=D,s.RegionsMap=S,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
