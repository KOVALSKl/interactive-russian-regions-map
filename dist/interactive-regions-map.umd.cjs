(function(c,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("d3")):typeof define=="function"&&define.amd?define(["exports","vue","d3"],t):(c=typeof globalThis<"u"?globalThis:c||self,t(c.InteractiveRegionsMap={},c.Vue,c.d3))})(this,function(c,t,j){"use strict";function I(i){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const e in i)if(e!=="default"){const l=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(r,e,l.get?l:{enumerable:!0,get:()=>i[e]})}}return r.default=i,Object.freeze(r)}const d=I(j),B={class:"map-region"},O=["id","d"],b={props:["d","data"],emits:["regionClicked"],setup(i,{emit:r}){const e=i;return(l,a)=>(t.openBlock(),t.createElementBlock("g",B,[t.renderSlot(l.$slots,"map-region-component",{d:e.d,onClick:a[0]||(a[0]=s=>r("regionClicked",{event:s,data:i.data}))},()=>[t.createElementVNode("path",{id:`path_${i.data.properties.id}`,class:"map-region-path",d:e.d,onClick:a[1]||(a[1]=s=>r("regionClicked",{event:s,data:i.data}))},null,8,O)])]))}},E={class:"map-container w-100"},_=["width","height","viewBox"],v={id:"regions-container"},M=t.createElementVNode("path",{fill:"none",stroke:"white","stroke-linejoin":"round"},null,-1),T={props:{mapData:{type:Object,required:!0},path:{type:Function,required:!0},width:{type:Number,default:900},height:{type:Number,default:900}},emits:["regionClicked"],setup(i,{emit:r}){const e=i;return(l,a)=>(t.openBlock(),t.createElementBlock("div",E,[(t.openBlock(),t.createElementBlock("svg",{id:"map",width:e.width,height:e.height,viewBox:[0,0,e.width,e.height]},[t.createElementVNode("g",v,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.mapData.features,s=>(t.openBlock(),t.createBlock(b,{key:s.properties.id,id:s.properties.id,data:s,d:i.path(s),onRegionClicked:a[0]||(a[0]=f=>r("regionClicked",f))},null,8,["id","data","d"]))),128)),M])],8,_))]))}},N=(i,r)=>{const e=i.__vccOpts||i;for(const[l,a]of r)e[l]=a;return e},z={class:"map-provider-container"},$=N({props:{width:{type:Number,default:900},height:{type:Number,default:900},mapData:{type:Object,required:!0},mapDataIndexes:{type:Object,default:null},mapProjection:{type:Object,default:null},animationDurationTime:{type:Number,default:1500},disableZoomOnClick:{type:Boolean,default:!1},regionsColorSchema:{type:Object,default:{}},regionDefaultColor:{type:String,default:"#444"},chosenRegionColor:{type:String,default:"red"}},emits:["nextRegion","previousRegion","regionClicked","mapClicked"],setup(i,{emit:r}){const e=i,l=e.mapData.features.length,a=new Map,s=t.computed(()=>e.mapProjection??d.geoTransverseMercator().fitSize([e.width,e.height],e.mapData).rotate([-90,0]).center([-20,-20])),f=t.computed(()=>e.mapData.features[g.value]),g=t.ref(0),x=t.ref(d.geoPath().projection(s.value)),y=t.ref(d.zoom().scaleExtent([1,8]).on("zoom",A)),k=t.ref(null),h=t.ref(e.regionsColorSchema),C=t.ref(null);t.watch(f,(n,o)=>{var u,m;console.log(o.properties.id),console.log(h);let p=o.properties.id in h.value;console.log(p),(u=a.get(o.properties.id))==null||u.style.setProperty("fill",p?h.value[o.properties.id].color:e.regionDefaultColor),(m=a.get(n.properties.id))==null||m.style.setProperty("fill",e.chosenRegionColor)}),t.watch(h,n=>{console.log(h),P(n)});function P(n){var o;for(let[p,u]of a.entries()){const m=((o=n[p])==null?void 0:o.color)??e.regionDefaultColor;u.style.setProperty("fill",m)}}function w(n){n<0?g.value=l-1:n>=l?g.value=0:g.value=n}function q(n){for(let o=0;o<l;o++)if(e.mapData[o].properties.id===n.properties.id)return o}function V(n){let o=n.properties.id;return e.mapDataIndexes[o].index}function F(){w(++g.value),D(),r("nextRegion")}function L(){w(--g.value),D(),r("previousRegion")}function D(){let n=f.value.properties.id;a.get(n).dispatchEvent(new PointerEvent("click",void 0))}function A(n){const{transform:o}=n;C.value.attr("transform",o),C.value.attr("stroke-width",1/o.k)}function Z(){r("mapClicked"),k.value.transition().duration(e.animationDurationTime).call(y.value.transform,d.zoomIdentity,d.zoomTransform(k.value.node()).invert([e.width/2,e.height/2]))}function G({event:n,data:o}){const[[p,u],[m,S]]=x.value.bounds(o);n.stopPropagation();let R;e.mapDataIndexes?R=V(o):R=q(o),w(R),k.value.transition().duration(e.animationDurationTime).call(y.value.transform,d.zoomIdentity.translate(e.width/2,e.height/2).scale(Math.min(8,.9/Math.max((m-p)/e.width,(S-u)/e.height))).translate(-(p+m)/2,-(u+S)/2)),r("regionClicked",{event:n,data:o})}return t.onMounted(()=>{k.value=d.select("svg").on("click",Z).call(y.value),C.value=d.select("#regions-container");const n=document.querySelectorAll("path.map-region-path").values();for(let o of n)a.set(o.parentElement.id,o);P(e.regionsColorSchema),D()}),(n,o)=>(t.openBlock(),t.createElementBlock("div",z,[t.renderSlot(n.$slots,"map",{width:i.width,height:i.height,mapData:i.mapData,path:x.value,onRegionClicked:G},void 0,!0),t.renderSlot(n.$slots,"default",{currentRegion:t.unref(f),onNextRegion:F,onPreviousRegion:L},void 0,!0)]))}},[["__scopeId","data-v-c831511b"]]);c.MapProvider=$,c.MapRegion=b,c.RegionsMap=T,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
